<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>I Promised: No Alcohol ‚Äî Countdown + Emoji Game</title>
<style>
  html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,sans-serif;color:#fff;overflow:hidden;background:#000}
  /* Arka plan resmi */
  body::before{
    content:""; position:fixed; inset:0; z-index:0;
    background:url("bg.jpg") center/cover no-repeat fixed;
  }
  body::after{
    content:""; position:fixed; inset:0; z-index:1;
    background:radial-gradient(ellipse at center, rgba(0,0,0,.2) 0%, rgba(0,0,0,.5) 70%, rgba(0,0,0,.8) 100%);
    pointer-events:none;
  }

  .overlay{ position:fixed; inset:0; background:rgba(0,0,0,.35); z-index:1 }

  /* Oyun alanƒ± */
  #gameCanvas{ position:fixed; inset:0; z-index:2; display:none; }

  .card{
    position:relative; z-index:3; max-width:820px; margin:22px auto; padding:26px;
    background:rgba(0,0,0,.55); border-radius:18px; text-align:center;
  }
  h1{margin:0 0 8px}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:14px 0}
  .box{background:rgba(255,255,255,.10);padding:14px;border-radius:12px}
  .num{font-size:32px;font-weight:800}
  .lbl{font-size:12px;opacity:.85}

  .controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:12px}
  .btn{background:#fff;color:#111;font-weight:800;border:none;border-radius:999px;padding:10px 14px;cursor:pointer}
  .btn:active{transform:scale(.98)}

  #startOverlay{position:fixed;inset:0;z-index:6;display:grid;place-items:center;background:rgba(0,0,0,.55)}
  #startOverlay button{font-size:16px;font-weight:900;padding:14px 18px;border-radius:999px;border:none;cursor:pointer}

  /* Modal (Game Over + Username) */
  .modal{position:fixed;inset:0;z-index:7;display:none;background:rgba(0,0,0,.55);align-items:center;justify-content:center}
  .modal-card{background:rgba(0,0,0,.78);border-radius:16px;padding:22px;width:min(90vw,380px);text-align:center}
  .actions{display:flex;gap:10px;justify-content:center;margin-top:12px}
  .field{display:flex;gap:8px;justify-content:center;margin-top:12px}
  .input{padding:10px 12px;border-radius:10px;border:none;outline:none;width:60%}
  .note{opacity:.8;font-size:12px;margin-top:6px}

  /* Top3 tablo */
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:8px 10px;text-align:left}
  th{opacity:.8}
  tr:nth-child(even){background:rgba(255,255,255,.05)}
</style>
</head>
<body>
  <div class="overlay"></div>

  <main class="card" aria-live="polite">
    <h1>I Promised: No Alcohol ‚è≥</h1>
    <section class="grid" aria-label="Countdown">
      <div class="box"><div id="d" class="num">‚Äì</div><div class="lbl">Days</div></div>
      <div class="box"><div id="h" class="num">‚Äì</div><div class="lbl">Hours</div></div>
      <div class="box"><div id="m" class="num">‚Äì</div><div class="lbl">Minutes</div></div>
      <div class="box"><div id="s" class="num">‚Äì</div><div class="lbl">Seconds</div></div>
    </section>

    <div class="controls">
      <button id="musicToggle" class="btn">Play Music</button>
      <button id="musicMute" class="btn">Unmute</button>
    </div>

    <button id="playGameBtn" class="btn" style="margin-top:16px;display:none">Play Game</button>
    <p style="opacity:.85;margin:.4rem 0 0">Double tap/click also starts the game. Single tap = fireworks üéÜ</p>
  </main>

  <canvas id="gameCanvas"></canvas>

  <!-- Username Modal -->
  <div id="nameModal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <h2>Enter a unique username</h2>
      <div class="field">
        <input id="nameInput" class="input" type="text" maxlength="20" placeholder="Your name">
        <button id="nameOk" class="btn">OK</button>
      </div>
      <div id="nameErr" class="note" style="color:#ffabab;display:none">This name is taken. Try another.</div>
      <div class="note">Names are unique. Your best score is saved on this device.</div>
    </div>
  </div>

  <!-- Game Over -->
  <div id="gameOver" class="modal" aria-hidden="true">
    <div class="modal-card">
      <h2>Game Over</h2>
      <p>Score: <span id="finalScore">0</span></p>

      <h3 style="margin:.5rem 0 0">Top 3</h3>
      <table id="top3">
        <thead><tr><th>#</th><th>Name</th><th>Best</th></tr></thead>
        <tbody></tbody>
      </table>

      <div class="actions">
        <button id="playAgainBtn" class="btn">Play Again</button>
        <button id="exitGameBtn" class="btn">Exit</button>
      </div>
    </div>
  </div>

  <!-- Start -->
  <div id="startOverlay">
    <button id="startBtn">Start (enable sound)</button>
  </div>

  <audio id="bgmusic" loop>
    <source src="music.mp3" type="audio/mpeg">
  </audio>

<script>
function $(s){return document.querySelector(s)}
const els = {
  d: $("#d"), h: $("#h"), m: $("#m"), s: $("#s"),
  music: $("#bgmusic"),
  musicToggle: $('#musicToggle'), musicMute: $('#musicMute'),
  startOverlay: $('#startOverlay'), startBtn: $('#startBtn'),
  playGameBtn: $('#playGameBtn'),
  gameCanvas: $('#gameCanvas'),
  gameOver: $('#gameOver'), finalScore: $('#finalScore'),
  playAgainBtn: $('#playAgainBtn'), exitGameBtn: $('#exitGameBtn'),
  nameModal: $('#nameModal'), nameInput: $('#nameInput'), nameOk: $('#nameOk'), nameErr: $('#nameErr'),
  top3Body: document.querySelector('#top3 tbody')
};

const DEVICE = (()=>{ const ua=navigator.userAgent||""; return {
  isAndroid:/Android/i.test(ua),
  isIOS:/iPhone|iPad|iPod/i.test(ua)
};})();
const deviceFactor = DEVICE.isAndroid ? 0.90 : DEVICE.isIOS ? 1.10 : 1.00;

/* Countdown */
const DEADLINE = new Date("2025-10-07T23:59:59");
function pad(n){return String(n).padStart(2,"0")}
function tick(){
  const now=new Date(); let diff=Math.max(0,DEADLINE-now);
  const d=Math.floor(diff/86400000); diff-=d*86400000;
  const h=Math.floor(diff/3600000); diff-=h*3600000;
  const m=Math.floor(diff/60000); diff-=m*60000;
  const s=Math.floor(diff/1000);
  els.d.textContent=d; els.h.textContent=pad(h); els.m.textContent=pad(m); els.s.textContent=pad(s);
}
tick(); setInterval(tick,1000);

/* Music */
let playing=false;
els.musicToggle.onclick=()=>{ if(!playing){ els.music.play(); playing=true; } else { els.music.pause(); playing=false; } };
els.musicMute.onclick=()=>{ els.music.muted=!els.music.muted };

/* Start overlay */
els.startBtn.onclick=async()=>{
  try{ await els.music.play(); playing=true; els.music.muted=false; }catch(e){}
  els.startOverlay.style.display="none";
  els.playGameBtn.style.display="inline-block";
};

/* --- (oyun + skor sistemi aynƒ± ≈üekilde devam ediyor) --- */
/* ... burada oyun, skor kaydƒ±, top 3, fireworks kodlarƒ± devam ediyor ... */
</script>
</body>
</html>
